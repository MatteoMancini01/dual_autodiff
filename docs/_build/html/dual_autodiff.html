

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Automatic Differentiation &mdash; Automatic Differentiation with Dual Numbers Project beta documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/sg_gallery.css?v=d2d258e8" />
      <link rel="stylesheet" type="text/css" href="_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=f0d2c090"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Solutions" href="Solutions.html" />
    <link rel="prev" title="Quick Start" href="pag/quick_start.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Automatic Differentiation with Dual Numbers Project
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="pag/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="pag/quick_start.html">Quick Start</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Automatic Differentiation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Package-Structure">Package Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Background">Background</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Automatic Differentiation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Coding">Coding</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Automatic-Differentiation-In-1D">Automatic Differentiation In 1D</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Automatic-Differentiation-In-Higher-Dimensions">Automatic Differentiation In Higher Dimensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Exercises">Exercises</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Solutions.html">Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="pag/api_reference.html">Api Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Automatic Differentiation with Dual Numbers Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Automatic Differentiation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/dual_autodiff.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Automatic-Differentiation">
<h1>Automatic Differentiation<a class="headerlink" href="#Automatic-Differentiation" title="Link to this heading"></a></h1>
<section id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Link to this heading"></a></h2>
<p>This Jupyter Notebook is designed as a guide to illustrate how to use the <code class="docutils literal notranslate"><span class="pre">dual_autodiff</span></code> package, a Python package created to perform automatic differentiations using dual numbers. Firstly, a brief introduction on the concepts of dual numbers and automatic differentiations, then some examples on how to use the package. Furthermore, there is also a cythonised vesrion the package namely <code class="docutils literal notranslate"><span class="pre">dual_autodiff_x</span></code>.</p>
</section>
<section id="Package-Structure">
<h2>Package Structure<a class="headerlink" href="#Package-Structure" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">dual_autodiff</span></code> structure:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>├──<span class="w"> </span>dual_autodiff/
│<span class="w">   </span>├──<span class="w"> </span>__init__.py
│<span class="w">   </span>├──<span class="w"> </span>dual.py
│<span class="w">   </span>├──<span class="w"> </span>n_diff.py
│<span class="w">   </span>└──<span class="w"> </span>version.py
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">dual.py</span></code> is the module that contains the class <code class="docutils literal notranslate"><span class="pre">Dual</span></code>, this class allows us to perform dual number algebra, thus one can use it to perform automatic differentiation, by setting the dual part of a dual number equal to one.</p>
<p>And <code class="docutils literal notranslate"><span class="pre">n_diff.py</span></code> is a module that contains the class <code class="docutils literal notranslate"><span class="pre">NumDiff</span></code>, this contains four different dunstions <code class="docutils literal notranslate"><span class="pre">first_forward</span></code>, <code class="docutils literal notranslate"><span class="pre">first_central</span></code>, <code class="docutils literal notranslate"><span class="pre">first_backward</span></code> and <code class="docutils literal notranslate"><span class="pre">second_order</span></code>, the first three are designed to compute first order numerical derivatives, while the last one computes second order numerical derivatives.</p>
<p>The module <code class="docutils literal notranslate"><span class="pre">n_diff.py</span></code> was constructed for the purpose of comparing numerical derivative methods performance against automatic differentiation through dual numbers.</p>
<p><code class="docutils literal notranslate"><span class="pre">dual_autodiff_x</span></code> structure:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>├──<span class="w"> </span>src
│<span class="w">   </span>├──<span class="w"> </span>dual_autodiff_x
│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>__init__.py
│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>__pycache__
│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>dual.c
│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>dual.pyx
│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>n_diff.c
│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>n_diff.pyx
│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>version.py
</pre></div>
</div>
<p>As you can oberve <code class="docutils literal notranslate"><span class="pre">dual_autodiff_x</span></code> has a similar structure to the pure python package;</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> initialises the package and provides imports for easy access to its modules.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__pycache__/</span></code> a direcotry automatically created by Python to store compiled versions of the package modules for faster loading.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dual.c</span></code> is a C file generated from <code class="docutils literal notranslate"><span class="pre">dual.pyx</span></code> by Cython, containing the compiled implementation of the <code class="docutils literal notranslate"><span class="pre">Dual</span></code> class for improved performance (i.e. faster computational power).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dual.pyx</span></code> is a Cython file containing the implementation of the <code class="docutils literal notranslate"><span class="pre">Dual</span></code> class for algebric computaions and automatic differentiation using dual numbers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n_diff.c</span></code> is a C file generated from <code class="docutils literal notranslate"><span class="pre">n_diff.pyx</span></code> by Cython, containing the complied implementation of numerical differentiation methods.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n_diff.pyx</span></code> is a Cython file containing the implementation of numerical differentiaion methods for first-order and second-order derivatives.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__version.py</span></code> is a module to manage and define the package version information.</p></li>
</ul>
<p>Both <code class="docutils literal notranslate"><span class="pre">Dual</span></code> and <code class="docutils literal notranslate"><span class="pre">DualX</span></code> classes have the same functions, same applies for the classes <code class="docutils literal notranslate"><span class="pre">NumDiff</span></code> and <code class="docutils literal notranslate"><span class="pre">NumDiffX</span></code>, later on we are going to compare the performance of pure Python packages vs Cython packages.</p>
</section>
<section id="Background">
<h2>Background<a class="headerlink" href="#Background" title="Link to this heading"></a></h2>
<p>This is a brief sections where we aim to introduce the concept of a dual number, and how one can use them for automatic differentiation (more details are provided in the report). ##### Definition of Dual Numbers Dual numbers are a hypercomplex number system, these are expressed in the form <span class="math notranslate nohighlight">\(a + \epsilon b\)</span>, where <span class="math notranslate nohighlight">\(a,b \in \mathbb{R}\)</span>, and <span class="math notranslate nohighlight">\(\epsilon\)</span> is the infinitesimal unit which satisfy <span class="math notranslate nohighlight">\(\epsilon^n\)</span>, for <span class="math notranslate nohighlight">\(n \geq 2, n \in \mathbb{N}\)</span> and with
<span class="math notranslate nohighlight">\(0 &lt; \epsilon &lt;&lt;1\)</span>. ##### Algebra of Dual Numbers Let us define <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> to be dual numbers and <span class="math notranslate nohighlight">\(m\)</span> a real number, in particular <span class="math notranslate nohighlight">\(x = a + \epsilon b\)</span> and <span class="math notranslate nohighlight">\(y = c + \epsilon d\)</span>, where <span class="math notranslate nohighlight">\(a,b,c,d \in \mathbb{R}\)</span>. Then the following results hold:</p>
<ol class="arabic simple">
<li><p>Addition:</p></li>
</ol>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(x + y = a+c + \epsilon(b+d)\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(x + m = a+m + \epsilon d\)</span></p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>Subtraction:</p></li>
</ol>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(x - y = a-c + \epsilon(b-d)\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(x - m = a-m + \epsilon d\)</span></p></li>
</ul>
<ol class="arabic simple" start="3">
<li><p>Multiplication:</p></li>
</ol>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(xy = ac + \epsilon (ad + cb)\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(xm = am + \epsilon bm\)</span></p></li>
</ul>
<ol class="arabic simple" start="4">
<li><p>Division:</p></li>
</ol>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\frac{x}{y} = \frac{a}{c} + \epsilon \left(\frac{b}{c} - \frac{ad}{c^2}\right)\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\frac{x}{m} = \frac{a}{m} + \epsilon \frac{b}{m}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\frac{m}{y} = \frac{m}{c} + \epsilon \frac{md}{c^2}\)</span></p></li>
</ul>
<ol class="arabic simple" start="5">
<li><p>Power:</p></li>
</ol>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(x^m = a^m + \epsilon mba^{m-1}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(m^x = m^a \left(1 + \epsilon \log{(m)}b\right)\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(x^y = a^c \left[1 + \epsilon \left(\frac{cb}{a} + \log{(a)}d\right)\right]\)</span></p></li>
</ul>
<p>(All of the above algebric computation are included in both Python and Cython packages)</p>
<section id="id1">
<h3>Automatic Differentiation<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<p>Given any n-degree polynomial, with <span class="math notranslate nohighlight">\(x\)</span> domain <span class="math">\begin{equation}
P(x) = p_0 + p_1 x + p_2 x^2 + ... + p_n x^n\tag{1}
\end{equation}</span></p>
<p>If we allow <span class="math notranslate nohighlight">\(x\)</span> to have a real and dual part, i.e. let <span class="math notranslate nohighlight">\(x = a + \epsilon b\)</span>, then <span class="math">\begin{equation}
P(a + \epsilon b) = P(a) + \epsilon bP'(a)\tag{2}
\end{equation}</span> From Eq. (2) one can observe that, the real part of the RHS is the polynomial evaluated at <span class="math notranslate nohighlight">\(a\)</span> while the dual part its the derivative of the polynomila evaluated at <span class="math notranslate nohighlight">\(a\)</span> times the dual coefficient b.</p>
<p>Generally this can be extended to any analytical real funtion when, computing their Taylor series, i.e. <span class="math">\begin{equation}
f(a + \epsilon b) = \sum^{\inf}_{n=0} \frac{f^{(n)}(a)b^n\epsilon^n}{n!} = f(a) + \epsilon bf'(a)\tag{3}
\end{equation}</span></p>
<p>(More information can be found in the report)</p>
<p>If one constructs the domanin of any analytical real function to be dual numbers, where the coefficent <span class="math notranslate nohighlight">\(a\)</span> to be any real number and set the coefficient <span class="math notranslate nohighlight">\(b=1\)</span> then, the real part of any analytical real function is the function evaluated at the point <span class="math notranslate nohighlight">\(a\)</span> while the dual part is the function’s derivative evaluated at the point <span class="math notranslate nohighlight">\(a\)</span>. We will see more examples in the coding section.</p>
<p>Reference: <a class="reference external" href="https://en.wikipedia.org/wiki/Dual_number">Wikipedia</a></p>
</section>
</section>
<section id="Coding">
<h2>Coding<a class="headerlink" href="#Coding" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importing required packages</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Importing our packages</span>

<span class="c1"># Pure Python</span>
<span class="kn">from</span> <span class="nn">dual_autodiff</span> <span class="kn">import</span> <span class="n">Dual</span>
<span class="kn">from</span> <span class="nn">dual_autodiff</span> <span class="kn">import</span> <span class="n">NumDiff</span>

<span class="c1"># Cythonised</span>
<span class="kn">from</span> <span class="nn">src.dual_autodiff_x</span> <span class="kn">import</span> <span class="n">DualX</span>
<span class="kn">from</span> <span class="nn">src.dual_autodiff_x</span> <span class="kn">import</span> <span class="n">NumDiffX</span>
</pre></div>
</div>
</div>
<p>Simple examples</p>
<ol class="arabic simple">
<li><p>Check if <code class="docutils literal notranslate"><span class="pre">Dual</span></code> and <code class="docutils literal notranslate"><span class="pre">DualX</span></code> are working correctly</p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">Dual</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">xc</span> <span class="o">=</span> <span class="n">DualX</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pure Python:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;x = </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The real part of x is </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">real</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The dual part of x is </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">dual</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cythonised:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;xc = </span><span class="si">{</span><span class="n">xc</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The real part of xc is </span><span class="si">{</span><span class="n">xc</span><span class="o">.</span><span class="n">real</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The dual part of xc is </span><span class="si">{</span><span class="n">xc</span><span class="o">.</span><span class="n">dual</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Pure Python:
x = Dual(real = 2, dual = 1)
The real part of x is 2
The dual part of x is 1

Cythonised:
xc = Dual(real = 2, dual = 1)
The real part of xc is 2
The dual part of xc is 1
</pre></div></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Addion simple example</p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">Dual</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;x + y = </span><span class="si">{</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
x + y = Dual(real = 5, dual = 3)
</pre></div></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Example with the sine function</p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sin_x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">sin</span><span class="p">()</span>
<span class="n">sin_xc</span> <span class="o">=</span> <span class="n">xc</span><span class="o">.</span><span class="n">sin</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pure Python:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sin(2 + ε) = </span><span class="si">{</span><span class="n">sin_x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Derivative of sine at 2 is </span><span class="si">{</span><span class="n">sin_x</span><span class="o">.</span><span class="n">dual</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cythonised:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sin(2 + ε) = </span><span class="si">{</span><span class="n">sin_xc</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Derivative of sine at 2 is </span><span class="si">{</span><span class="n">sin_xc</span><span class="o">.</span><span class="n">dual</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># this is true as the dual part of x is 1</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Pure Python:
sin(2 + ε) = Dual(real = 0.9092974268256817, dual = -0.4161468365471424)
Derivative of sine at 2 is -0.4161468365471424

Cythonised:
sin(2 + ε) = Dual(real = 0.9092974268256817, dual = -0.4161468365471424)
Derivative of sine at 2 is -0.4161468365471424
</pre></div></div>
</div>
<ol class="arabic" start="4">
<li><p>Quick illustration on how to use <code class="docutils literal notranslate"><span class="pre">NumDiff</span></code> and <code class="docutils literal notranslate"><span class="pre">NumDiffX</span></code></p>
<p>Say we want to compute the numerical derivative of the function <span class="math notranslate nohighlight">\(f(x) = x^2 + exp(x)\)</span>.</p>
</li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the function you want to differentiate</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Define analytical derivative to compere results</span>

<span class="k">def</span> <span class="nf">der</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># Evaluating the derivative at the point a=2</span>
<span class="n">h</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="c1"># Stepsize</span>

<span class="n">fx</span> <span class="o">=</span> <span class="n">NumDiff</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="c1"># setting up for puer Python</span>
<span class="n">fxc</span>  <span class="o">=</span> <span class="n">NumDiffX</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">h</span><span class="p">)</span> <span class="c1"># setting up for Cython</span>

<span class="n">derivative_of_fx</span> <span class="o">=</span> <span class="n">fx</span><span class="o">.</span><span class="n">first_central</span><span class="p">()</span> <span class="c1"># computing the central difference with pure Python</span>
<span class="n">derivative_of_fxc</span> <span class="o">=</span> <span class="n">fxc</span><span class="o">.</span><span class="n">first_central</span><span class="p">()</span> <span class="c1"># computing the central difference with Cython</span>

<span class="c1"># Checing results</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pure Python:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The numerical derivative of f(x) at x=2 is </span><span class="si">{</span><span class="n">derivative_of_fx</span><span class="si">}</span><span class="s1"> (central difference).&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cython:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The numerical derivative of f(x) at x=2 is </span><span class="si">{</span><span class="n">derivative_of_fxc</span><span class="si">}</span><span class="s1"> (central difference).&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The analytical derivative of f(x) at x=2 is </span><span class="si">{</span><span class="n">der</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Pure Python:
The numerical derivative of f(x) at x=2 is 11.389179250481263 (central difference).

Cython:
The numerical derivative of f(x) at x=2 is 11.389179250481263 (central difference).

The analytical derivative of f(x) at x=2 is 11.38905609893065.
</pre></div></div>
</div>
<ol class="arabic simple" start="5">
<li><p>Repeating example 4, using <code class="docutils literal notranslate"><span class="pre">Dual</span></code> and <code class="docutils literal notranslate"><span class="pre">DualX</span></code></p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Defining our variable x in terms of dual numbers</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">Dual</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Python</span>
<span class="n">xc</span> <span class="o">=</span> <span class="n">DualX</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Cython</span>

<span class="c1"># Defining f(x)</span>
<span class="n">funx</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span> <span class="c1"># Python</span>
<span class="n">funxc</span> <span class="o">=</span> <span class="n">xc</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">xc</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span> <span class="c1"># Cython</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pure Python:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The derivative computed with dual numbers of f(x) at x=2 is </span><span class="si">{</span><span class="n">funx</span><span class="o">.</span><span class="n">real</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cython:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The derivative computed with dual numbers of f(x) at x=2 is </span><span class="si">{</span><span class="n">funxc</span><span class="o">.</span><span class="n">real</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The analytical derivative of f(x) at x=2 is </span><span class="si">{</span><span class="n">der</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Pure Python:
The derivative computed with dual numbers of f(x) at x=2 is 11.38905609893065.

Cython:
The derivative computed with dual numbers of f(x) at x=2 is 11.38905609893065.

The analytical derivative of f(x) at x=2 is 11.38905609893065.
</pre></div></div>
</div>
<ol class="arabic" start="6">
<li><p>Plotting using <code class="docutils literal notranslate"><span class="pre">Dual</span></code>, <code class="docutils literal notranslate"><span class="pre">DualX</span></code>, <code class="docutils literal notranslate"><span class="pre">NumDiff</span></code> and <code class="docutils literal notranslate"><span class="pre">NumDiffX</span></code></p>
<p>For this particular exaple, I want to show how to use packages <code class="docutils literal notranslate"><span class="pre">dual_autodiff</span></code> and <code class="docutils literal notranslate"><span class="pre">dual_autodiff_x</span></code> to plot fuctions and their deirvarives.</p>
<p>Let</p>
<div class="math notranslate nohighlight">
\[f(x) = \sin{x} + \sinh{x}\]</div>
<p>We are going to plot its derivative with different methods and compare the plot to the its analytical derivative.</p>
</li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the function f(x)</span>
<span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Define analytical derivative of f(x)</span>
<span class="k">def</span> <span class="nf">der_f1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Plots range</span>
<span class="n">x_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># Setting up for Dual and DualX</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">Dual</span><span class="p">(</span><span class="n">x_space</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">xc1</span> <span class="o">=</span> <span class="n">DualX</span><span class="p">(</span><span class="n">x_space</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Defining function in terms of dual numbers</span>
<span class="n">fx1_dual</span> <span class="o">=</span> <span class="n">x1</span><span class="o">.</span><span class="n">sin</span><span class="p">()</span> <span class="o">+</span> <span class="n">x1</span><span class="o">.</span><span class="n">sinh</span><span class="p">()</span>
<span class="n">fxc1_dual</span> <span class="o">=</span> <span class="n">xc1</span><span class="o">.</span><span class="n">sin</span><span class="p">()</span> <span class="o">+</span> <span class="n">xc1</span><span class="o">.</span><span class="n">sinh</span><span class="p">()</span>

<span class="c1"># Setting up for NumDiff and NumDiffX</span>
<span class="n">h</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="c1"># chose large value of h to exagerate the difference</span>
<span class="n">fx1</span> <span class="o">=</span> <span class="n">NumDiff</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">x_space</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
<span class="n">fxc1</span> <span class="o">=</span> <span class="n">NumDiffX</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="n">x_space</span><span class="p">,</span><span class="n">h</span><span class="p">)</span>

<span class="c1"># Computing Numerical Derivative with NumDiff and NumDiffX</span>
<span class="n">num_der_f1</span> <span class="o">=</span> <span class="n">fx1</span><span class="o">.</span><span class="n">first_forward</span><span class="p">()</span>
<span class="n">num_der_fc1</span><span class="o">=</span> <span class="n">fxc1</span><span class="o">.</span><span class="n">first_forward</span><span class="p">()</span>

<span class="c1"># Plotting the results</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> <span class="c1"># making subplots</span>

<span class="c1"># Pure Python</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_space</span><span class="p">,</span> <span class="n">der_f1</span><span class="p">(</span><span class="n">x_space</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Analytical&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_space</span><span class="p">,</span> <span class="n">num_der_f1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Numerical (forward difference h=</span><span class="si">{</span><span class="n">h</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_space</span><span class="p">,</span> <span class="n">fx1_dual</span><span class="o">.</span><span class="n">dual</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Automatic differentiation&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Plot with pure Python package&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.1</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="c1"># Cython</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_space</span><span class="p">,</span> <span class="n">der_f1</span><span class="p">(</span><span class="n">x_space</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Analytical&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_space</span><span class="p">,</span> <span class="n">num_der_fc1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Numerical (forward difference h=</span><span class="si">{</span><span class="n">h</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_space</span><span class="p">,</span> <span class="n">fxc1_dual</span><span class="o">.</span><span class="n">dual</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Automatic differentiation&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Plot with Cythonised package&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/dual_autodiff_17_0.png" src="_images/dual_autodiff_17_0.png" />
</div>
</div>
<p>As one expects, from the above plot one can obesrve that the derivative computed using automatic differentiation is exact!</p>
<p>##### Tackling Task 5 with Dual Numbers and Numerical Derivatives</p>
<p>Computing the derivative of <span class="math notranslate nohighlight">\(f(x)\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align*}
f(x) &amp;= log(sin(x)) + x^2cos(x)\\
f'(x) &amp;= cot(x) +  2xcos(x) - x^2sin(x)
\end{align*}\end{split}\]</div>
<p>When one defines the dual variable <span class="math notranslate nohighlight">\(x\)</span> to determine the derivative of any fucntions <span class="math notranslate nohighlight">\(f(x)\)</span> with respect to <span class="math notranslate nohighlight">\(x\)</span>, should always set the dual part of <span class="math notranslate nohighlight">\(x\)</span> equal to <span class="math notranslate nohighlight">\(1\)</span>. For instance, running the code <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">Dual(1.5,</span> <span class="pre">1)</span></code>, will ensure that the derivative of the function <span class="math notranslate nohighlight">\(f(x)\)</span> at <span class="math notranslate nohighlight">\(Real(x) = 1.5\)</span> is given by the dual part of <span class="math notranslate nohighlight">\(f(x)\)</span>. Given <span class="math notranslate nohighlight">\(x = a + \epsilon b\)</span>, then:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align*}
f(x) = f(a + \epsilon b) = f(a) + \epsilon b f'(a)\\
\end{align*}\end{split}\]</div>
<p>set <span class="math notranslate nohighlight">\(b=1\)</span> thus,</p>
<div class="math notranslate nohighlight">
\[\begin{align*}
f(x) = f(a + \epsilon) = f(a) + \epsilon f'(a)
\end{align*}\]</div>
<p>Hence the derivative of <span class="math notranslate nohighlight">\(f(x)\)</span> is given by its dual part.</p>
<p>Let us code the above:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># f(x)</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># f&#39;(x)</span>
<span class="k">def</span> <span class="nf">df_true</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Dual derivative</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">Dual</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># set dual part equal to 1</span>
<span class="n">f_dual</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">sin</span><span class="p">()</span><span class="o">.</span><span class="n">log</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">cos</span><span class="p">()</span>
<span class="n">df_dual</span> <span class="o">=</span> <span class="n">f_dual</span><span class="o">.</span><span class="n">dual</span> <span class="c1"># take the dual part of f to find its derivative at x.real=1.5</span>

<span class="c1"># Numerical solution</span>
<span class="n">h</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="c1"># step size</span>
<span class="n">ndf</span> <span class="o">=</span> <span class="n">NumDiff</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="c1"># x=1.5</span>
<span class="n">ndf_for</span> <span class="o">=</span> <span class="n">ndf</span><span class="o">.</span><span class="n">first_forward</span><span class="p">()</span> <span class="c1"># forward difference</span>
<span class="n">ndf_cen</span> <span class="o">=</span> <span class="n">ndf</span><span class="o">.</span><span class="n">first_central</span><span class="p">()</span> <span class="c1"># central difference</span>
<span class="n">ndf_bac</span> <span class="o">=</span> <span class="n">ndf</span><span class="o">.</span><span class="n">first_backward</span><span class="p">()</span> <span class="c1"># backward difference</span>

<span class="c1"># Analytical derivative</span>
<span class="n">true_der</span> <span class="o">=</span> <span class="n">df_true</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>

<span class="c1"># defining all measures to determine the ratio and the error between analytical and dual/numerical</span>
<span class="k">def</span> <span class="nf">ratio</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="n">m</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">absolute_error</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># Create a dataset to display the impormation collected using pandas</span>

<span class="n">information</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Automatic Differentiation&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">df_dual</span><span class="p">,</span> <span class="n">ratio</span><span class="p">(</span><span class="n">df_dual</span><span class="p">,</span><span class="n">true_der</span><span class="p">),</span> <span class="n">absolute_error</span><span class="p">(</span><span class="n">df_dual</span><span class="p">,</span> <span class="n">true_der</span><span class="p">)],</span>
    <span class="s2">&quot;Forward Differentiation&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">ndf_for</span><span class="p">,</span> <span class="n">ratio</span><span class="p">(</span><span class="n">ndf_for</span><span class="p">,</span><span class="n">true_der</span><span class="p">),</span> <span class="n">absolute_error</span><span class="p">(</span><span class="n">ndf_for</span><span class="p">,</span> <span class="n">true_der</span><span class="p">)],</span>
    <span class="s2">&quot;Central Differentiation&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">ndf_cen</span><span class="p">,</span> <span class="n">ratio</span><span class="p">(</span><span class="n">ndf_cen</span><span class="p">,</span><span class="n">true_der</span><span class="p">),</span> <span class="n">absolute_error</span><span class="p">(</span><span class="n">ndf_cen</span><span class="p">,</span> <span class="n">true_der</span><span class="p">)],</span>
    <span class="s2">&quot;Backward Differentiation&quot;</span><span class="p">:[</span><span class="n">ndf_bac</span><span class="p">,</span> <span class="n">ratio</span><span class="p">(</span><span class="n">ndf_bac</span><span class="p">,</span><span class="n">true_der</span><span class="p">),</span> <span class="n">absolute_error</span><span class="p">(</span><span class="n">ndf_bac</span><span class="p">,</span> <span class="n">true_der</span><span class="p">)]</span>
<span class="p">}</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">information</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Results&quot;</span><span class="p">,</span> <span class="s2">&quot;Ratio&quot;</span><span class="p">,</span> <span class="s2">&quot;Absolute Error&quot;</span><span class="p">])</span>
<span class="n">results</span> <span class="c1"># Displaying the output in a nice format</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Automatic Differentiation</th>
      <th>Forward Differentiation</th>
      <th>Central Differentiation</th>
      <th>Backward Differentiation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Results</th>
      <td>-1.961237</td>
      <td>-1.996346</td>
      <td>-1.961308</td>
      <td>-1.926270</td>
    </tr>
    <tr>
      <th>Ratio</th>
      <td>1.000000</td>
      <td>1.017901</td>
      <td>1.000036</td>
      <td>0.982171</td>
    </tr>
    <tr>
      <th>Absolute Error</th>
      <td>0.000000</td>
      <td>0.035109</td>
      <td>0.000071</td>
      <td>0.034967</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>As we can observe from the above table, automatic differentiation is exact, hence one can now measure the error of the three different numerical methods applyed for differntiation. A good way to visualise the error is through loglog plots. But before we do that, we shall plot the ration between the analytical derivative and automatic derivative.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># f&#39;(x)</span>
<span class="k">def</span> <span class="nf">df_true</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">x_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">3.25</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="c1"># same as before define a range of real values</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">Dual</span><span class="p">(</span><span class="n">x_space</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># defining variable</span>
<span class="n">function_x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">sin</span><span class="p">()</span><span class="o">.</span><span class="n">log</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">cos</span><span class="p">()</span> <span class="c1"># defining function</span>
<span class="n">ratio_</span> <span class="o">=</span> <span class="n">df_true</span><span class="p">(</span><span class="n">x_space</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">function_x</span><span class="o">.</span><span class="n">dual</span><span class="p">)</span> <span class="c1"># defining ratio</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_space</span><span class="p">,</span> <span class="n">ratio_</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Ratio&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Ratio Analytical Derivative vs Dual Part&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ratio list:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ratio_</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/root/Document/Python_Script/dual_autodiff/dual_autodiff/dual.py:834: RuntimeWarning: invalid value encountered in log
  real = np.log(self.real)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/dual_autodiff_22_1.png" src="_images/dual_autodiff_22_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ratio list:
[1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1.]
</pre></div></div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">loglog</span> <span class="pre">plots</span></code> is a common approach to visualize and measure errors across scales, especially in numerical methods and scientific computations. So here is how we are going to do it.</p>
<ul class="simple">
<li><p>Evaluate the derivative at a single point <span class="math notranslate nohighlight">\(x=1.5\)</span></p></li>
<li><p>Compute the numerical derivative for a range of values <span class="math notranslate nohighlight">\(h \in [0.001, 1]\)</span></p></li>
<li><p>Take the square difference</p></li>
<li><p>Plot the results into a <code class="docutils literal notranslate"><span class="pre">loglog</span></code> plot</p></li>
<li><p>Comment on the results</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># f(x)</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>


<span class="n">x</span> <span class="o">=</span> <span class="n">Dual</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># defining variable</span>
<span class="n">function_x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">sin</span><span class="p">()</span><span class="o">.</span><span class="n">log</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">cos</span><span class="p">()</span> <span class="c1"># defining function</span>
<span class="n">true_der</span> <span class="o">=</span> <span class="n">function_x</span><span class="o">.</span><span class="n">dual</span>

<span class="n">h_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.00001</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.00005</span><span class="p">)</span> <span class="c1"># define ranage of values for h</span>

<span class="n">der_f</span> <span class="o">=</span> <span class="n">NumDiff</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">h_space</span><span class="p">)</span> <span class="c1"># first step for numerical derivative</span>
<span class="c1"># Define each different numerical derivative</span>
<span class="n">forward_der</span> <span class="o">=</span> <span class="n">der_f</span><span class="o">.</span><span class="n">first_forward</span><span class="p">()</span>
<span class="n">central_der</span> <span class="o">=</span> <span class="n">der_f</span><span class="o">.</span><span class="n">first_central</span><span class="p">()</span>
<span class="n">backward_der</span> <span class="o">=</span> <span class="n">der_f</span><span class="o">.</span><span class="n">first_backward</span><span class="p">()</span>

<span class="c1"># evaluating the square errors</span>
<span class="n">error_forward</span> <span class="o">=</span> <span class="p">(</span><span class="n">true_der</span><span class="o">-</span><span class="n">forward_der</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<span class="n">error_central</span> <span class="o">=</span> <span class="p">(</span><span class="n">true_der</span><span class="o">-</span><span class="n">central_der</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<span class="n">error_backward</span> <span class="o">=</span> <span class="p">(</span><span class="n">true_der</span><span class="o">-</span><span class="n">backward_der</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

<span class="c1"># loglog plots</span>

<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">h_space</span><span class="p">,</span> <span class="n">error_forward</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Forward Difference Error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">h_space</span><span class="p">,</span> <span class="n">error_central</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Central Difference Error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">h_space</span><span class="p">,</span> <span class="n">error_backward</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Backward Difference Error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Grid size h&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;LogLog plot Error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/dual_autodiff_24_0.png" src="_images/dual_autodiff_24_0.png" />
</div>
</div>
<p>Comments</p>
<ol class="arabic simple">
<li><p>Forward Difference (Red):</p>
<ul class="simple">
<li><p>The error decreases linearly as h decreases, indicating first-order accuracy i.e. <span class="math notranslate nohighlight">\(\mathcal{O}h\)</span></p></li>
</ul>
</li>
<li><p>Central Difference (Purple):</p>
<ul class="simple">
<li><p>The error decreases at a steeper rater compared to the other two difference methods, showing second-order accuracy i.e. <span class="math notranslate nohighlight">\(\mathcal{O}h^2\)</span></p></li>
</ul>
</li>
<li><p>Backward Difference (Blue):</p>
<ul class="simple">
<li><p>Similarly to the Forward Difference method, the error decreases linearly, indicating first-order accuracy i.e <span class="math notranslate nohighlight">\(\mathcal{O}h\)</span>.</p></li>
</ul>
</li>
</ol>
<p>Conclusion: - Central Difference is the most accurate method as it achieves faster error reduction with decreasing <span class="math notranslate nohighlight">\(h\)</span>. - Forward Difference and Backward Difference are less accurate but exhibit comparable performance.</p>
<p>There is a test suite implemented for the pure Python classes <code class="docutils literal notranslate"><span class="pre">Dual</span></code> and <code class="docutils literal notranslate"><span class="pre">NumDiff</span></code>. This is how the tests directory is structured:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>├──<span class="w"> </span>tests
│<span class="w">   </span>├──<span class="w"> </span>__init__.py
│<span class="w">   </span>├──<span class="w"> </span>test_dad.py
│<span class="w">   </span>└──<span class="w"> </span>test_ndiff.py
</pre></div>
</div>
<p>This allows the user to download the test suite as a package and run in on the notebook.</p>
<p>Alternatively the user can run the test suite in the terminal with the following commad:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest<span class="w"> </span>-s<span class="w"> </span>tests/*
</pre></div>
</div>
<p>(Make sure your Python virtual environment is active)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Running test on the Notebook</span>
<span class="kn">from</span> <span class="nn">tests</span> <span class="kn">import</span> <span class="n">TestDual</span>
<span class="kn">from</span> <span class="nn">tests</span> <span class="kn">import</span> <span class="n">NumDiff</span>
<span class="kn">import</span> <span class="nn">ipytest</span>

<span class="n">TestDual</span>
<span class="n">NumDiff</span>
<span class="n">ipytest</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-bold">======================================= test session starts ========================================</span>
platform linux -- Python 3.12.3, pytest-8.3.3, pluggy-1.5.0
rootdir: /root/Document/Python_Script/dual_autodiff
configfile: pyproject.toml
plugins: anyio-4.7.0
collected 19 items

t_726e70948b184bdabb62cca301c364b1.py <span class="ansi-green-fg">.</span><span class="ansi-green-fg">.</span><span class="ansi-green-fg">.</span><span class="ansi-green-fg">.</span><span class="ansi-green-fg">.</span><span class="ansi-green-fg">.</span><span class="ansi-green-fg">.</span><span class="ansi-green-fg">.</span><span class="ansi-green-fg">.</span><span class="ansi-green-fg">.</span><span class="ansi-green-fg">.</span><span class="ansi-green-fg">.</span><span class="ansi-green-fg">.</span><span class="ansi-green-fg">.</span><span class="ansi-green-fg">.</span><span class="ansi-green-fg">.</span><span class="ansi-green-fg">.</span><span class="ansi-green-fg">.</span><span class="ansi-green-fg">.</span><span class="ansi-green-fg">                                    [100%]</span>

<span class="ansi-green-fg">======================================== </span><span class="ansi-green-intense-fg ansi-bold">19 passed</span><span class="ansi-green-fg"> in 0.05s</span><span class="ansi-green-fg"> ========================================</span>
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;ExitCode.OK: 0&gt;
</pre></div></div>
</div>
</section>
<section id="Automatic-Differentiation-In-1D">
<h2>Automatic Differentiation In 1D<a class="headerlink" href="#Automatic-Differentiation-In-1D" title="Link to this heading"></a></h2>
<p>As we have seen before:</p>
<p>For a function <span class="math notranslate nohighlight">\(f(x)\)</span>, whose domain are dual numbers, i.e. <span class="math notranslate nohighlight">\(a + \epsilon b\)</span>, where both <span class="math notranslate nohighlight">\(a,b \in \mathbb{R}\)</span>, then</p>
<div class="math notranslate nohighlight">
\[f(a + \epsilon b) = f(x)|_{x=a} + \epsilon b f'(x)|_{x=a}\]</div>
<p>Can we exten this concept into higher dimensions?</p>
</section>
<section id="Automatic-Differentiation-In-Higher-Dimensions">
<h2>Automatic Differentiation In Higher Dimensions<a class="headerlink" href="#Automatic-Differentiation-In-Higher-Dimensions" title="Link to this heading"></a></h2>
<p>We have seen how automatic differentiation using dual numbers is utilised in one dimension, but can we extend this into higher dimensions? The answer is yes. One can compute first order partial derivatives with respect to each variable for a high dimensional function.</p>
<p>Consider the function <span class="math notranslate nohighlight">\(f(\vec{x})\)</span>, where <span class="math notranslate nohighlight">\(\vec{x} = (x_1, x_2,...,x_n)^T\)</span>, whose domain <span class="math notranslate nohighlight">\(\vec{a} + \epsilon \vec{b}\)</span>, where <span class="math notranslate nohighlight">\(\vec{a} = (a_1, a_2,...,a_n)^T\)</span> and <span class="math notranslate nohighlight">\(\vec{b} = (b_1, b_2,...,b_n)^T\)</span>, then we can extend the one dimensional model to higher dimensions as follow:</p>
<div class="math notranslate nohighlight">
\[f(\vec{a} + \epsilon \vec{b}) = f(\vec{x})|_{\vec{x}=\vec{a}} + \epsilon \sum^n_{i=1} b_i \frac{\partial f(\vec{x})}{\partial x_i}|_{\vec{x} = \vec{a}}\]</div>
<p>If we set all <span class="math notranslate nohighlight">\(b_i=1\)</span> then the dual part of <span class="math notranslate nohighlight">\(f(\vec{a} + \epsilon \vec{b})\)</span> will be the sum of partial derivatives evaluated at <span class="math notranslate nohighlight">\(\vec{x} = \vec{a}\)</span>, but what if one wants to perform the partial derivative with repsect to a single valriable? The answer this question rather simple, we need to elimina the unwanted partial derivatives.</p>
<p>Let us define a new function <span class="math notranslate nohighlight">\(f_j(\vec{x})\)</span>, such that:</p>
<div class="math notranslate nohighlight">
\[f_j(\vec{a} + \epsilon \vec{b}) = f(\vec{x})|_{\vec{x}=\vec{a}} + \epsilon \sum^n_{i=1} \delta_{ij} b_i \frac{\partial f(\vec{x})}{\partial x_i}|_{\vec{x} = \vec{a}}\]</div>
<p>where <span class="math notranslate nohighlight">\(\delta_{ij}\)</span> is the kronecker delta, such that;</p>
<div class="math notranslate nohighlight">
\[\begin{split}\delta_{ij} =
\begin{cases}
0 &amp; \text{when } i \neq j \\
1 &amp; \text{when } i = j\\
\end{cases}\end{split}\]</div>
<p>And <span class="math notranslate nohighlight">\(\vec{b} = [1,1,1,...,1]^T\)</span>, <span class="math notranslate nohighlight">\(\vec{a}\)</span> is the collection of point where the partial derivative of <span class="math notranslate nohighlight">\(f(\vec{x})\)</span> is evaluated at. One can simplify the above equation into:</p>
<div class="math notranslate nohighlight">
\[f_j(\vec{a} + \epsilon \vec{b}) = f(\vec{x})|_{\vec{x}=\vec{a}} + \epsilon b_j \frac{\partial f(\vec{x})}{\partial x_j}|_{\vec{x} = \vec{a}}\]</div>
<p>The index <span class="math notranslate nohighlight">\(j\)</span> is the albitrary choice of the variable we want to differentiate for, e.g. if one wants to compute the partial derivative of <span class="math notranslate nohighlight">\(f(\vec{x})\)</span> with respect to <span class="math notranslate nohighlight">\(x_2\)</span> then set <span class="math notranslate nohighlight">\(j=2\)</span>, here we will see how:</p>
<p>Quick example on how to use <code class="docutils literal notranslate"><span class="pre">partial_derivative</span></code> from <code class="docutils literal notranslate"><span class="pre">Dual</span></code> and <code class="docutils literal notranslate"><span class="pre">DualX</span></code></p>
<p>Consider the function <span class="math notranslate nohighlight">\(f(x,y,z) = xy + x\cos{z} + \sin{y}\)</span>, one can compute the partial derivative with respect to each variable <span class="math notranslate nohighlight">\(x,y\)</span> and <span class="math notranslate nohighlight">\(z\)</span>, at the point <span class="math notranslate nohighlight">\((1, -1, 2)\)</span> using classes <code class="docutils literal notranslate"><span class="pre">Dual</span></code> and <code class="docutils literal notranslate"><span class="pre">DualX</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the fucntion we want to differentaiate</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="o">.</span><span class="n">cos</span><span class="p">()</span> <span class="o">+</span> <span class="n">y</span><span class="o">.</span><span class="n">sin</span><span class="p">()</span>


<span class="sd">&quot;&quot;&quot;</span>

<span class="sd">Computing partial derivatives, the first entery in partial_derivative(j,f,**args), j is the</span>
<span class="sd">index we want to differentiate with respect too i.e. x,y or z, their repsective enteries are 0,1 and 2</span>
<span class="sd">(i.e. for the variable x, the index j takes value j=0 and so on).</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Pure Python</span>
<span class="c1"># To initialise the code we need a dummy variable say d</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">Dual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="o">=</span><span class="n">Dual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">Dual</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">Dual</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="n">x_partial</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">partial_derivative</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span> <span class="c1"># partial derivative with respect to x use index 0</span>
<span class="n">y_partial</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">partial_derivative</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span> <span class="c1"># partial derivative with repsect to y use index 1</span>
<span class="n">z_partial</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">partial_derivative</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span> <span class="c1"># partial derivative with respect to z use index 2</span>

<span class="c1"># Cython (repeate the same process from the pure Python version)</span>
<span class="n">dc</span> <span class="o">=</span> <span class="n">DualX</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">xc</span><span class="p">,</span><span class="n">yc</span><span class="p">,</span><span class="n">zc</span> <span class="o">=</span> <span class="n">DualX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">DualX</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">DualX</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">xc_partial</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">partial_derivative</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">xc</span><span class="p">,</span><span class="n">yc</span><span class="p">,</span><span class="n">zc</span><span class="p">)</span> <span class="c1"># partial derivative with respect to x use index 0</span>
<span class="n">yc_partial</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">partial_derivative</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">xc</span><span class="p">,</span><span class="n">yc</span><span class="p">,</span><span class="n">zc</span><span class="p">)</span> <span class="c1"># partial derivative with repsect to y use index 1</span>
<span class="n">zc_partial</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">partial_derivative</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">xc</span><span class="p">,</span><span class="n">yc</span><span class="p">,</span><span class="n">zc</span><span class="p">)</span> <span class="c1"># partial derivative with respect to z use index 2</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Results from pure Python class Dual:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Partial derivaive of f with respect to x, at x,y,z=1,-1,2 is </span><span class="si">{</span><span class="n">x_partial</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Partial derivaive of f with respect to y, at x,y,z=1,-1,2 is </span><span class="si">{</span><span class="n">y_partial</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Partial derivaive of f with respect to z, at x,y,z=1,-1,2 is </span><span class="si">{</span><span class="n">z_partial</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Results from Cythonised class DualX:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Partial derivaive of f with respect to x, at x,y,z=1,-1,2 is </span><span class="si">{</span><span class="n">xc_partial</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Partial derivaive of f with respect to y, at x,y,z=1,-1,2 is </span><span class="si">{</span><span class="n">yc_partial</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Partial derivaive of f with respect to z, at x,y,z=1,-1,2 is </span><span class="si">{</span><span class="n">zc_partial</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<br/><br/><br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Results from pure Python class Dual
Partial derivaive of f with respect to x, at x,y,z=1,-1,2 is -1.4161468365471424
Partial derivaive of f with respect to y, at x,y,z=1,-1,2 is 1.5403023058681398
Partial derivaive of f with respect to z, at x,y,z=1,-1,2 is -0.9092974268256817

Results from Cythonised class DualX
Partial derivaive of f with respect to x, at x,y,z=1,-1,2 is -1.4161468365471424
Partial derivaive of f with respect to y, at x,y,z=1,-1,2 is 1.5403023058681398
Partial derivaive of f with respect to z, at x,y,z=1,-1,2 is -0.9092974268256817
</pre></div></div>
</div>
<p>To compare performance between the pure Python vs the Cythonised vesrions of the package we are going to use the module <code class="docutils literal notranslate"><span class="pre">timeit</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">timeit</span></code> module in Python is a standard library tool used to measure the execution time of small code snippets. It is particularly useful for benchmarking and identifying performance bottlenecks.</p>
<p>Here some key features of <code class="docutils literal notranslate"><span class="pre">timeit</span></code>:</p>
<ol class="arabic simple">
<li><p>Accurate Timing:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">timeit</span></code> disable useless collections and runs code multiple times to provide a more accurate measurement of execution time (by default <code class="docutils literal notranslate"><span class="pre">timeit</span></code> will output an estimate of time per loop, including mean time and its standard deviation).</p></li>
</ul>
</li>
<li><p>Easy to Use:</p>
<ul class="simple">
<li><p>You can measure execution time of code directly in a script or interactively in the Python shell.</p></li>
</ul>
</li>
<li><p>Adaptive:</p>
<ul class="simple">
<li><p>You can control the number of repetitions and iterations to balance accuracy and performance.</p></li>
</ul>
</li>
</ol>
<p>For our purposes we do not need to customise <code class="docutils literal notranslate"><span class="pre">timeit</span></code>, instead we are going to use its default features. For more information on how to use <code class="docutils literal notranslate"><span class="pre">timeit</span></code>, please see <a class="reference external" href="https://docs.python.org/3/library/timeit.html">timeit</a>.</p>
<p>We want to compare the following performances: 1. <code class="docutils literal notranslate"><span class="pre">Dual</span></code> vs <code class="docutils literal notranslate"><span class="pre">DualX</span></code> 2. <code class="docutils literal notranslate"><span class="pre">NumDiff</span></code> vs <code class="docutils literal notranslate"><span class="pre">NumDiffX</span></code></p>
<p>For case (1), we want to performe the comparison twice, with the simplest function (i.e. retun a dual number) and then with a more complex function (taking the dual and real part separately of a function).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>

<span class="sd">Defining 4 sets of functions, 2 simple (Python and Cython), and 2 complex (Python and Cython)</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="c1"># Simple functions, return a dual number</span>

<span class="c1"># Python</span>
<span class="k">def</span> <span class="nf">test_dual_simple</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dual</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>

<span class="c1"># Cython</span>
<span class="k">def</span> <span class="nf">test_dual_x_simple</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">DualX</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>

<span class="c1"># Complex funtion, return real and dual part separalely</span>

<span class="c1"># Python</span>
<span class="k">def</span> <span class="nf">test_dual_complex</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="n">x</span><span class="o">=</span><span class="n">Dual</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
    <span class="n">func</span><span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">sin</span><span class="p">()</span><span class="o">+</span><span class="n">x</span><span class="o">.</span><span class="n">cos</span><span class="p">()</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">tanh</span><span class="p">()</span>
    <span class="n">real</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">real</span>
    <span class="n">dual</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">dual</span>
    <span class="k">return</span> <span class="n">real</span><span class="p">,</span> <span class="n">dual</span>

<span class="c1"># Cython</span>
<span class="k">def</span> <span class="nf">test_dual_x_complex</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="n">x</span><span class="o">=</span><span class="n">DualX</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
    <span class="n">func</span><span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">sin</span><span class="p">()</span><span class="o">+</span><span class="n">x</span><span class="o">.</span><span class="n">cos</span><span class="p">()</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">tanh</span><span class="p">()</span>
    <span class="n">real</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">real</span>
    <span class="n">dual</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">dual</span>
    <span class="k">return</span> <span class="n">real</span><span class="p">,</span> <span class="n">dual</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">timeit</span> <span class="c1"># importing required package</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="sd">%timeit -n &lt;number_of_loops&gt; -r &lt;number_of_runs&gt; &lt;code_to_test&gt;</span>

<span class="sd">After -n insert number of loops</span>
<span class="sd">After -r insert number of runs</span>

<span class="sd">I am running tests for 10**7 loops, if is too much for your local machine,</span>
<span class="sd">please feel free to lower the number of loops or the number of runs!</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Simple Test&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Python:&#39;</span><span class="p">)</span>
<span class="o">%</span><span class="k">timeit</span> -n 10000000 -r 10 test_dual_simple(2,1) # simple test for Python
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cython:&#39;</span><span class="p">)</span>
<span class="o">%</span><span class="k">timeit</span> -n 10000000 -r 10 test_dual_x_simple(2,1) # simple test for Cython
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Complex Test&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Python:&#39;</span><span class="p">)</span>
<span class="o">%</span><span class="k">timeit</span> -n 10000000 -r 10 test_dual_complex(100,345) # complex test for Python
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cython:&#39;</span><span class="p">)</span>
<span class="o">%</span><span class="k">timeit</span> -n 10000000 -r 10 test_dual_x_complex(100,345) # complex test for Cython
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simple Test
Python:
148 ns ± 3.99 ns per loop (mean ± std. dev. of 10 runs, 10,000,000 loops each)
Cython:
88.1 ns ± 2.02 ns per loop (mean ± std. dev. of 10 runs, 10,000,000 loops each)

Complex Test
Python:
10.1 μs ± 65.3 ns per loop (mean ± std. dev. of 10 runs, 10,000,000 loops each)
Cython:
9.39 μs ± 1.29 μs per loop (mean ± std. dev. of 10 runs, 10,000,000 loops each)
</pre></div></div>
</div>
<p>From the above result, one can notice that the Cythonised version of the package is faster for both tests (as one my expect), in the simple test the Cythonised version is significantly faster than the pure Python version, but there is not much difference between the two for the complex test in terms of performance.</p>
<p>Difference between the two test</p>
<p>Simple Test: In the simple test, we constructed a function that runs the simplest task, takes two variable as input a that will be allocated as real and dual part of a number, i.e. <code class="docutils literal notranslate"><span class="pre">Dual(a,b)</span></code> for pure Python, and <code class="docutils literal notranslate"><span class="pre">DualX(a,b)</span></code> for the Cythonised version, here the Cythonised version is much faster.</p>
<p>Complex Test: In the complex test, we constructed a function that takes two variables as input and allocates them into real and dual part, there are two majior differences between complex and simple test.</p>
<ol class="arabic simple">
<li><p>Simple test we are allocating input into real and dual part, while in the complex case we allocate the input to a dual number <span class="math notranslate nohighlight">\(x\)</span>. Then we evaluate the function <span class="math notranslate nohighlight">\(f(x) = \sin{x}+ \cos{x} + x^2e^x + \tanh{x}\)</span> with the dual number <span class="math notranslate nohighlight">\(x\)</span>.</p></li>
<li><p>After evaluating <span class="math notranslate nohighlight">\(f(x)\)</span> at <span class="math notranslate nohighlight">\(x = a + \epsilon b\)</span>, the functions <code class="docutils literal notranslate"><span class="pre">test_dual_complex</span></code> and <code class="docutils literal notranslate"><span class="pre">test_dual_x_complex</span></code> retun the real and dual part separately. This is not a problem for the pure Python version as no major modifications are implemented in order to return <code class="docutils literal notranslate"><span class="pre">.real</span></code> and <code class="docutils literal notranslate"><span class="pre">.dual</span></code> separately, while this caused some issues when Cythonising the package, i.e. it would not recognise <code class="docutils literal notranslate"><span class="pre">.real</span></code> and <code class="docutils literal notranslate"><span class="pre">.dual</span></code>. To overcome the prolem two extra functions were implemented using
<code class="docutils literal notranslate"><span class="pre">&#64;property</span></code>, <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">real(self)</span></code> and <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">dual(self)</span></code>, to return <code class="docutils literal notranslate"><span class="pre">.real</span></code> and <code class="docutils literal notranslate"><span class="pre">.dual</span></code>. I belive this is one of the reason why for the complex test the Cythonised version is only outpefroming the pure Python version by <span class="math notranslate nohighlight">\(0.71 \mu s\)</span> (this is the result obtained when running the code, the user my get a different answer). Furthermore, when defining input varicbles with <code class="docutils literal notranslate"><span class="pre">cdef</span></code>, <code class="docutils literal notranslate"><span class="pre">object</span></code> was utilised instead of <code class="docutils literal notranslate"><span class="pre">double</span></code>, this significantly slows down perfomance, but allows more
fexilibility, e.g. takes arrays as inputs.</p></li>
</ol>
<p>What are the difference between <code class="docutils literal notranslate"><span class="pre">double</span></code> and <code class="docutils literal notranslate"><span class="pre">object</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">double</span></code>:</p>
<p><code class="docutils literal notranslate"><span class="pre">double</span></code> reoresents a C-style double-precision floating point number. This is used when high-perfomance numerical computations is required, furthermore this works directly with C-style numeric types. <code class="docutils literal notranslate"><span class="pre">double</span></code> has a fixed size (usually 8 bytes) and does not involve Python’s memory managment, this performs much faster than Python’s <code class="docutils literal notranslate"><span class="pre">float</span></code>(a <code class="docutils literal notranslate"><span class="pre">float</span></code> in Python is an <code class="docutils literal notranslate"><span class="pre">object</span></code> type).</p>
<p>Limitations:</p>
<ul class="simple">
<li><p>Cannot handle Python’s arbitrary-precision floats.</p></li>
<li><p>Cannot be <code class="docutils literal notranslate"><span class="pre">None</span></code> or any other non-numerical values</p></li>
<li><p>Less flexible than <code class="docutils literal notranslate"><span class="pre">object</span></code>, as mentioned <code class="docutils literal notranslate"><span class="pre">double</span></code> does not take arrays</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">object</span></code>:</p>
<p>This represents a generic Python <code class="docutils literal notranslate"><span class="pre">object</span></code> and it can hold any type of Python data (e.g. <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code>, <code class="docutils literal notranslate"><span class="pre">lists</span></code>, <code class="docutils literal notranslate"><span class="pre">str</span></code> or custom objects). This is generally used its flexibility as it allows interaction with Python’s dynamic typing system. In terms of memory usage, <code class="docutils literal notranslate"><span class="pre">object</span></code> is more expensive than <code class="docutils literal notranslate"><span class="pre">double</span></code> as it uses Python’s heap memory and is managed by Python’s garbage collector.</p>
<p>Limitations:</p>
<ul class="simple">
<li><p>Significantly slower than <code class="docutils literal notranslate"><span class="pre">double</span></code></p></li>
</ul>
<p>Conclusion:</p>
<p>In our scenario, (we are not looking for extrimely fast performance) we are trading run time with flexibility.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Testing NumDiff and NumDiffX performances</span>

<span class="sd">&#39;&#39;&#39;</span>

<span class="c1"># Define function we want to differentiate</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>

<span class="sd">For both pure Python and Cythonised versions, we are going to perform a test</span>
<span class="sd">on the central difference (as we have previusly seen is also the most accurate</span>
<span class="sd">of the 3 different first order numerical derivatives)</span>

<span class="sd">&#39;&#39;&#39;</span>

<span class="c1"># Pure Python</span>
<span class="k">def</span> <span class="nf">non_cythonized</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
    <span class="n">der</span><span class="o">=</span><span class="n">NumDiff</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">h</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">der</span><span class="o">.</span><span class="n">first_central</span><span class="p">()</span>

<span class="c1"># Cythonised</span>
<span class="k">def</span> <span class="nf">cythonized</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
    <span class="n">der</span><span class="o">=</span><span class="n">NumDiffX</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">h</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">der</span><span class="o">.</span><span class="n">first_central</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><br/><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Python test:&#39;</span><span class="p">)</span>
<span class="o">%</span><span class="k">timeit</span> -n 1000000 -r 10 non_cythonized(f,2,0.1)
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cython test&#39;</span><span class="p">)</span>
<span class="o">%</span><span class="k">timeit</span> -n 1000000 -r 10 cythonized(f,2,0.1)
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Python test:
2.03 μs ± 45.6 ns per loop (mean ± std. dev. of 10 runs, 1,000,000 loops each)

Cython test
1.92 μs ± 22.7 ns per loop (mean ± std. dev. of 10 runs, 1,000,000 loops each)
</pre></div></div>
</div>
</section>
<section id="Exercises">
<h2>Exercises<a class="headerlink" href="#Exercises" title="Link to this heading"></a></h2>
<p>Now try yourself.</p>
<p>Complete the following sets of exercises, in case of multivariable function compute the partial derivative with respeact to each variable, solutions are provided in the Solutions.ipynb:</p>
<ol class="arabic">
<li><p>Compute the derivative by hand of the following functions:</p>
<ul class="simple">
<li><p>Polynomial</p></li>
</ul>
<p><span class="math">\begin{equation}
f(x) = x^3 - 4x^2 + 6x - 2 \tag{1}
\end{equation}</span></p>
<ul class="simple">
<li><p>Exponential</p></li>
</ul>
<p><span class="math">\begin{equation}
g(x) = e^x - 2x\tag{2}
\end{equation}</span></p>
<ul class="simple">
<li><p>Trigonometric</p></li>
</ul>
<p><span class="math">\begin{equation}
h(x) = \sin{x} + \cos{2x}\tag{3}
\end{equation}</span></p>
<ul class="simple">
<li><p>Two-Variable Function</p></li>
</ul>
<p><span class="math">\begin{equation}
f(x,y) = x^2 + y^2 + 3xy - 5\tag{4}
\end{equation}</span></p>
<ul class="simple">
<li><p>Three-Variable Function</p></li>
</ul>
<p><span class="math">\begin{equation}
g(x,y,z) = e^{x+y}cos(z) - x^2 + y\tag{5}
\end{equation}</span></p>
</li>
<li><p>Now compute the derivative of each function using the module <code class="docutils literal notranslate"><span class="pre">dual_autodiff</span></code> or <code class="docutils literal notranslate"><span class="pre">src.dual_autodiff_x</span></code>, at <span class="math notranslate nohighlight">\(x=2\)</span> for Eq. (1,2,3), <span class="math notranslate nohighlight">\((x,y)=(-1,1)\)</span> for Eq. (4) and <span class="math notranslate nohighlight">\((x,y,z) = (2,3,-4)\)</span> for Eq. (5), compare the results with part 1.</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="pag/quick_start.html" class="btn btn-neutral float-left" title="Quick Start" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Solutions.html" class="btn btn-neutral float-right" title="Solutions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Matteo Mancini.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>